function filtrarPedidos() {
  const filtroNumero = document.getElementById('filtroPedido').value.toLowerCase();
  const filtroFabrica = document.getElementById('filtroFabrica').value;

  const filtrados = [];

  pedidosCache.forEach(pedido => {
    // Cada pedido tem uma lista de itens
    pedido.itens.forEach(item => {
      const numeroMatch = !filtroNumero || pedido.numero.toLowerCase().includes(filtroNumero);
      const fabricaMatch = !filtroFabrica || pedido.fabrica === filtroFabrica;
      if (numeroMatch && fabricaMatch) {
        filtrados.push({
          numero: pedido.numero,
          fabrica: pedido.fabrica,
          codigo: item.codigo,
          descricao: item.descricao,
          quantidade: item.quantidade,
          dataPedido: pedido.dataPedido
        });
      }
    });
  });

  renderizarPedidos(filtrados);
}

function renderizarPedidos(pedidos) {
  const tbody = document.getElementById("pedidosBody");
  tbody.innerHTML = "";
  if (pedidos.length === 0) { 
    tbody.innerHTML = `<tr><td colspan="6">Nenhum pedido encontrado</td></tr>`; 
    return; 
  }

  pedidos.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.numero}</td><td>${p.fabrica}</td><td>${p.codigo}</td><td>${p.descricao}</td><td>${p.quantidade}</td><td>${p.dataPedido}</td>`;
    tbody.appendChild(tr);
  });
}
