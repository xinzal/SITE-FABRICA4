<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro de Pedidos</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }
    header {
        background-color: #003c8f;
        color: white;
        text-align: center;
        padding: 15px;
        font-size: 22px;
    }
    main {
        padding: 20px;
        max-width: 900px;
        margin: auto;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select {
        padding: 8px;
        margin: 5px 0;
        width: 100%;
        box-sizing: border-box;
    }
    button {
        background-color: #003c8f;
        color: white;
        border: none;
        padding: 10px 15px;
        margin-top: 10px;
        border-radius: 6px;
        cursor: pointer;
    }
    button:hover {
        background-color: #0055c9;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    table th, table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }
    table th {
        background-color: #003c8f;
        color: white;
    }
    .tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 15px;
    }
    .tab {
        padding: 10px 20px;
        cursor: pointer;
        background: #ddd;
        border-radius: 6px 6px 0 0;
        margin-right: 5px;
    }
    .tab.active {
        background: white;
        border-bottom: 2px solid white;
        color: #003c8f;
        font-weight: bold;
    }
    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }
</style>
</head>
<body>
<header>Cadastro de Pedidos</header>

<main>
    <div class="tabs">
        <div class="tab active" onclick="openTab('cadastro')">Cadastrar Pedido</div>
        <div class="tab" onclick="openTab('visualizar')">Visualizar Pedidos</div>
    </div>

    <!-- ====== CADASTRO ====== -->
    <div id="cadastro" class="tab-content active">
        <h3>Dados do Pedido</h3>
        <label>N칰mero do Pedido:</label>
        <input type="text" id="numeroPedido">

        <label>F치brica de destino:</label>
        <input type="text" id="fabrica">

        <h4>Itens do Pedido</h4>
        <div id="itensContainer">
            <div class="item">
                <label>C칩digo do Produto:</label>
                <input type="text" class="codigo">
                <label>Descri칞칚o:</label>
                <input type="text" class="descricao">
                <label>Quantidade:</label>
                <input type="number" class="quantidade" min="1" value="1">
            </div>
        </div>

        <button type="button" onclick="adicionarItem()">+ Adicionar Item</button><br>
        <button type="button" onclick="enviarPedido()">Enviar Pedido</button>
    </div>

    <!-- ====== VISUALIZAR ====== -->
    <div id="visualizar" class="tab-content">
        <h3>Pedidos Cadastrados</h3>
        <button onclick="carregarPedidos()">游댃 Atualizar Lista</button>
        <table id="tabelaPedidos">
            <thead>
                <tr>
                    <th>N칰mero</th>
                    <th>F치brica</th>
                    <th>C칩digo</th>
                    <th>Descri칞칚o</th>
                    <th>Quantidade</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</main>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzJOmABpg-yBT3pTYvTY4K9HdHiA2g7yyVC5FbvopPjgUfdudUkpCmzmhybL7MeomjrqQ/exec";

function openTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
    document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add('active');
    document.getElementById(tabName).classList.add('active');
}

function adicionarItem() {
    const container = document.getElementById('itensContainer');
    const item = document.createElement('div');
    item.classList.add('item');
    item.innerHTML = `
        <label>C칩digo do Produto:</label>
        <input type="text" class="codigo">
        <label>Descri칞칚o:</label>
        <input type="text" class="descricao">
        <label>Quantidade:</label>
        <input type="number" class="quantidade" min="1" value="1">
    `;
    container.appendChild(item);
}

async function enviarPedido() {
    const numero = document.getElementById('numeroPedido').value.trim();
    const fabrica = document.getElementById('fabrica').value.trim();

    if (!numero || !fabrica) {
        alert("Preencha o n칰mero do pedido e a f치brica.");
        return;
    }

    const itens = Array.from(document.querySelectorAll('#itensContainer .item')).map(div => ({
        codigo: div.querySelector('.codigo').value.trim(),
        descricao: div.querySelector('.descricao').value.trim(),
        quantidade: div.querySelector('.quantidade').value.trim()
    })).filter(i => i.codigo || i.descricao);

    if (itens.length === 0) {
        alert("Adicione ao menos um item.");
        return;
    }

    const dados = { numero, fabrica, itens };

    try {
        const res = await fetch(WEB_APP_URL, {
            method: 'POST',
            body: JSON.stringify(dados),
            headers: { 'Content-Type': 'application/json' }
        });
        const result = await res.json();

        if (result.status === "success") {
            alert("Pedido cadastrado com sucesso!");
            document.getElementById('numeroPedido').value = "";
            document.getElementById('fabrica').value = "";
            document.getElementById('itensContainer').innerHTML = "";
            adicionarItem();
        } else {
            alert("Erro: " + result.message);
        }
    } catch (err) {
        alert("Erro na conex칚o: " + err.message);
    }
}

async function carregarPedidos() {
    try {
        const res = await fetch(WEB_APP_URL + "?action=get");
        const data = await res.json();
        const tbody = document.querySelector("#tabelaPedidos tbody");
        tbody.innerHTML = "";

        data.forEach(p => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${p.numero || ""}</td>
                <td>${p.fabrica || ""}</td>
                <td>${p.codigo || ""}</td>
                <td>${p.descricao || ""}</td>
                <td>${p.quantidade || ""}</td>
                <td>${p.dataPedido || ""}</td>
            `;
            tbody.appendChild(row);
        });
    } catch (err) {
        alert("Erro ao carregar pedidos: " + err.message);
    }
}
</script>
</body>
</html>
