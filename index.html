<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solicitar Pedido</title>
<style>
    body { font-family: Arial, sans-serif; background-color: #f2f4f8; padding: 20px; }
    h1 { color: #003c8f; margin-bottom: 20px; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
    button { padding: 8px 15px; margin-top: 15px; background-color: #0073c9; color: white; border: none; cursor: pointer; border-radius: 4px; }
    button:hover { background-color: #005fa3; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background-color: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #0073c9; color: white; }
    td button { background-color: #c0392b; }
    td button:hover { background-color: #922b21; }
    nav { margin-bottom: 20px; }
    nav button { margin-right: 10px; }
    .tab { display: none; }
    .tab.active { display: block; }
</style>
</head>
<body>

<h1>Solicitar Pedido</h1>

<nav>
    <button onclick="abrirAba('formTab')">Novo Pedido</button>
    <button onclick="abrirAba('visualizarTab')">Visualizar Pedidos</button>
</nav>

<!-- Aba de Cadastro -->
<div id="formTab" class="tab active">
    <form id="pedidoForm">
        <label for="numeroPedido">Número do Pedido:</label>
        <input type="text" id="numeroPedido">

        <label for="fabric">Fábrica:</label>
        <select id="fabric">
            <option value="">Selecione</option>
            <option value="UNA">UNA</option>
            <option value="ICNB">ICNB</option>
            <option value="NATUPHITUS">NATUPHITUS</option>
            <option value="NATURELLE">NATURELLE</option>
            <option value="AERCAMP">AERCAMP</option>
            <option value="DECOR">DECOR</option>
        </select>

        <h2>Itens do Pedido</h2>
        <div>
            <input type="text" id="codigoItem" placeholder="Código do Produto">
            <input type="text" id="descricaoItem" placeholder="Descrição">
            <input type="number" id="quantidadeItem" placeholder="Quantidade" value="1" min="1">
            <button type="button" onclick="adicionarItem()">Adicionar Item</button>
        </div>

        <table id="itensTable">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Descrição</th>
                    <th>Quantidade</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button type="button" onclick="enviarPedido()">Enviar Pedido</button>
    </form>
</div>

<!-- Aba de Visualização -->
<div id="visualizarTab" class="tab">
    <h2>Pedidos Solicitados</h2>
    <table id="pedidosTable">
        <thead>
            <tr>
                <th>Número do Pedido</th>
                <th>Fábrica</th>
                <th>Código do Item</th>
                <th>Descrição do Item</th>
                <th>Quantidade do Item</th>
                <th>Data do Pedido</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <button onclick="carregarPedidos()">Atualizar Pedidos</button>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxC-8uADhJUhTxigcRt9bwVv6bGHAPbk-A160yWxGYSDm10xUJ8KF6LcTN7s7mRJx-Thw/exec";

// Alterna entre abas
function abrirAba(id) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id === 'visualizarTab') carregarPedidos();
}

// Adicionar item
function adicionarItem() {
    const codigo = document.getElementById('codigoItem').value.trim();
    const descricao = document.getElementById('descricaoItem').value.trim();
    const quantidade = document.getElementById('quantidadeItem').value.trim();
    if(!codigo || !descricao || !quantidade){ alert("Preencha todos os campos do item."); return; }
    const tbody = document.querySelector("#itensTable tbody");
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${codigo}</td><td>${descricao}</td><td>${quantidade}</td><td><button type="button" onclick="removerItem(this)">Remover</button></td>`;
    tbody.appendChild(tr);
    document.getElementById('codigoItem').value=''; document.getElementById('descricaoItem').value=''; document.getElementById('quantidadeItem').value=1;
}

// Remover item
function removerItem(btn){ btn.closest('tr').remove(); }

// Enviar pedido
async function enviarPedido() {
    const numero = document.getElementById('numeroPedido').value.trim();
    const fabrica = document.getElementById('fabric').value;
    const rows = document.querySelectorAll("#itensTable tbody tr");
    if(!numero || !fabrica){ alert("Preencha número do pedido e fábrica."); return; }
    if(rows.length===0){ alert("Adicione ao menos um item."); return; }

    const itens = Array.from(rows).map(r=>({codigo:r.cells[0].innerText, descricao:r.cells[1].innerText, quantidade:Number(r.cells[2].innerText)}));
    const pedido = {numero, fabrica, itens};

    try {
        const response = await fetch(WEB_APP_URL,{method:"POST", body:JSON.stringify(pedido)});
        const result = await response.json();
        if(result.status==="success"){ 
            alert("Pedido enviado!"); 
            document.getElementById('pedidoForm').reset(); 
            document.querySelector("#itensTable tbody").innerHTML=''; 
        } else alert("Erro: "+result.message);
    } catch(err){ console.error(err); alert("Erro de conexão."); }
}

// Carregar pedidos
async function carregarPedidos() {
    try {
        const response = await fetch(WEB_APP_URL+"?action=get");
        const pedidos = await response.json();
        const tbody = document.querySelector("#pedidosTable tbody");
        tbody.innerHTML='';
        pedidos.forEach(p=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${p.numero}</td><td>${p.fabrica}</td><td>${p.codigo}</td><td>${p.descricao}</td><td>${p.quantidade}</td><td>${new Date(p.dataPedido).toLocaleString()}</td>`;
            tbody.appendChild(tr);
        });
    } catch(err){ console.error(err); alert("Erro ao carregar pedidos."); }
}
</script>

</body>
</html>
